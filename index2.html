<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³æ¨‚å½±åƒè³€å¡ (YouTube Edition) ğŸµğŸ“¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        :root { 
            --primary: #6c5ce7; 
            --bg: #f1f2f6; 
            --soft-red: #ffe3e3; 
            --flip-duration: 2.2s; 
            --card-width: 350px;
            --card-height: 500px;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; perspective: 2000px; overflow: hidden; }
        
        /* å¡ç‰‡å®¹å™¨ */
        #card-container { width: var(--card-width); height: var(--card-height); position: relative; transform-style: preserve-3d; transition: transform var(--flip-duration) cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        #card-container.is-open { transform: translateX(175px); }

        /* ç¿»é–‹çš„å°é¢ */
        #card-flap { position: absolute; width: 100%; height: 100%; top: 0; left: 0; transform-style: preserve-3d; transform-origin: left; transition: transform var(--flip-duration) cubic-bezier(0.4, 0, 0.2, 1); z-index: 100; }
        .hint-animation { animation: flap-hint 3s ease-in-out infinite; }
        @keyframes flap-hint { 0%, 100% { transform: rotateY(0deg); } 50% { transform: rotateY(-12deg); } }

        #card-container.is-open #card-flap { transform: rotateY(-180deg); }
        
        /* å°é¢åœ–ç‰‡ */
        #card-cover { position: absolute; width: 100%; height: 100%; background-image: url('IMG_6823.jpeg'); background-size: cover; background-position: center; border-radius: 0 15px 15px 0; backface-visibility: hidden; box-shadow: 10px 0 20px rgba(0,0,0,0.1); }
        /* å¦‚æœæ²’æœ‰åœ–ç‰‡ï¼Œçµ¦ä¸€å€‹é è¨­æ¼¸å±¤ */
        #card-cover.no-img { background: linear-gradient(135deg, #a8c0ff 0%, #3f2b96 100%); display:flex; align-items:center; justify-content:center; color:white; font-size:24px; font-weight:bold;}

        /* å·¦å´å…§é  (ç¿»é–‹å¾Œå°é¢çš„èƒŒé¢) */
        #card-left-inner { position: absolute; width: 100%; height: 100%; background-color: var(--soft-red); background-image: url('white6.png'); background-size: contain; background-repeat: no-repeat; background-position: center; border-radius: 15px 0 0 15px; transform: rotateY(180deg); backface-visibility: hidden; }

        /* å³å´å…§é  (ä¸»è¦å…§å®¹å€) */
        #card-right-inner { position: absolute; width: 100%; height: 100%; top: 0; left: 0; background: white; border-radius: 0 15px 15px 0; display: flex; flex-direction: column; align-items: center; padding: 25px 20px; box-sizing: border-box; z-index: 10; clip-path: inset(0 0 0 100%); transition: clip-path 1.8s cubic-bezier(0.19, 1, 0.22, 1); }
        #card-container.is-open #card-right-inner { clip-path: inset(0 0 0 0); }
        
        /* éŸ³æ¨‚è¦–è¦ºåŒ– (å–ä»£é‹¼ç´) */
        #music-visualizer { 
            display: flex; justify-content: center; align-items: flex-end; 
            width: 100%; height: 60px; background: #2d3436; 
            border-radius: 8px; margin-bottom: 20px; padding: 10px; box-sizing: border-box; gap: 4px;
        }
        .bar { width: 6px; background: #ff7675; animation: equalizer 1s ease-in-out infinite; border-radius: 2px; height: 10%; }
        /* ç”¢ç”Ÿéš¨æ©Ÿæ³¢å‹• */
        .bar:nth-child(1) { animation-duration: 0.8s; } .bar:nth-child(2) { animation-duration: 1.1s; } .bar:nth-child(3) { animation-duration: 1.3s; }
        .bar:nth-child(4) { animation-duration: 0.9s; } .bar:nth-child(5) { animation-duration: 1.2s; } .bar:nth-child(6) { animation-duration: 1.0s; }
        .bar:nth-child(7) { animation-duration: 1.4s; } .bar:nth-child(8) { animation-duration: 0.8s; } .bar:nth-child(9) { animation-duration: 1.1s; }
        .bar:nth-child(10) { animation-duration: 0.9s; }
        
        @keyframes equalizer { 0%, 100% { height: 10%; } 50% { height: 80%; } }
        
        /* éš±è— YouTube Player (åªè½è²éŸ³) */
        #youtube-player-container { position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none; top: -1000px; }

        /* ç·¨è¼¯å™¨ UI */
        .editor-box { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 420px; margin: 20px; z-index: 500; text-align: center; }
        .editor-box h3 { color: var(--primary); margin: 0 0 15px 0; }
        input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: var(--primary); color: white; margin-top: 8px; transition: 0.2s; font-size: 15px; }
        button:active { transform: scale(0.98); }
        button.secondary { background: #b2bec3; }

        /* å…§æ–‡æ‰“å­—æ•ˆæœ */
        #typing-text { font-size: 1.1rem; font-weight: 700; color: #2d3436; text-align: center; min-height: 4em; white-space: pre-wrap; margin-top: 10px; line-height: 1.6; }
        
        .hidden { display: none !important; }
        .status-text { font-size: 12px; color: #636e72; margin-top: 5px; }
    </style>
</head>
<body>

<div id="editor-ui" class="editor-box">
    <h3>ğŸ’Œ è£½ä½œä½ çš„éŸ³æ¨‚è³€å¡</h3>
    <p style="font-size:14px; color:#666;">è¼¸å…¥ç¥ç¦èªï¼ŒèƒŒæ™¯éŸ³æ¨‚å·²è¨­ç‚ºå°ˆå±¬æ’­æ”¾æ¸…å–®ã€‚</p>
    
    <input type="text" id="userMsg" value="ç¥ä½ ä»Šå¤©æœ‰å€‹æ—‹å¾‹èˆ¬çš„å¥½å¿ƒæƒ…" placeholder="è¼¸å…¥ç¥ç¦çš„è©±...">
    
    <button onclick="generatePureUrl()">ğŸ”— è¤‡è£½ä¸¦åˆ†äº«è³€å¡é€£çµ</button>
    <button class="secondary" onclick="previewCard()">ğŸ‘€ é è¦½å¡ç‰‡æ•ˆæœ</button>
    <p class="status-text">éŸ³æ¨‚ä¾†æºï¼šYouTube Playlist</p>
</div>

<div id="card-container" class="hidden" onclick="unlockAudioAndOpen()">
    <div id="card-flap" class="hint-animation">
        <div id="card-cover"></div> 
        <div id="card-left-inner"></div>
    </div>
    <div id="card-right-inner">
        <div id="music-visualizer">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div>
        </div>
        
        <div id="typing-text"></div>
        
        <div id="qrcode-container" style="margin-top:auto;"></div>
        <p style="font-size:10px; color:#b2bec3; margin-top:5px;">Click card to play music</p>
    </div>
</div>

<div id="youtube-player-container">
    <div id="yt-player"></div>
</div>

<script>
    // YouTube Player API è®Šæ•¸
    let player;
    let isPlayerReady = false;
    const PLAYLIST_ID = 'PL1U2BLQmiBscIDy9QQvCmAF-rKjhafMuM'; // æ‚¨æŒ‡å®šçš„æ’­æ”¾æ¸…å–®

    // 1. è¼‰å…¥ YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 2. API æº–å‚™å°±ç·’å¾Œçš„å›èª¿
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            height: '200',
            width: '200',
            playerVars: {
                'listType': 'playlist',
                'list': PLAYLIST_ID,
                'autoplay': 0,      // æ‰‹æ©Ÿç‰ˆé€šå¸¸ç¦æ­¢è‡ªå‹•æ’­æ”¾ï¼Œéœ€ä½¿ç”¨è€…äº’å‹•
                'controls': 0,      // éš±è—æ§åˆ¶é …
                'showinfo': 0,      // èˆŠç‰ˆåƒæ•¸ï¼Œç›¡é‡æ¸›å°‘è³‡è¨Š
                'loop': 1,          // å¾ªç’°æ’­æ”¾
                'playsinline': 1    // iOS é‡è¦åƒæ•¸ï¼Œé˜²æ­¢å…¨è¢å¹•å½ˆå‡º
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        isPlayerReady = true;
        console.log("YouTube Player Ready");
        // ç‚ºäº†ç¢ºä¿æ’­æ”¾æ¸…å–®éš¨æ©Ÿæˆ–å¾é ­é–‹å§‹ï¼Œå¯ä»¥åœ¨é€™è£¡è¨­å®š
        player.setShuffle(true); 
    }

    function onPlayerStateChange(event) {
        // å¯ä»¥åœ¨é€™è£¡åµæ¸¬æ’­æ”¾ç‹€æ…‹ï¼Œä¾‹å¦‚æ’­æ”¾çµæŸè‡ªå‹•é‡æ’­ç­‰
        // å¦‚æœæ˜¯ playlist loop æ¨¡å¼ï¼ŒYouTube é€šå¸¸æœƒè‡ªå‹•è™•ç†
    }

    // --- è³€å¡é‚è¼¯ ---

    let typingInterval = null;
    let isCardOpened = false;

    window.onload = () => {
        // æª¢æŸ¥æ˜¯å¦æœ‰å°é¢åœ–ç‰‡ï¼Œæ²’æœ‰çš„è©±çµ¦ä¸€å€‹é è¨­æ¨£å¼
        const cover = document.getElementById('card-cover');
        const img = new Image();
        img.src = 'IMG_6823.jpeg';
        img.onerror = () => {
            cover.style.backgroundImage = 'none';
            cover.classList.add('no-img');
            cover.innerHTML = "ğŸ¶";
        };

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('v')) {
            // è§€çœ‹æ¨¡å¼
            document.getElementById('editor-ui').classList.add('hidden');
            document.getElementById('card-container').classList.remove('hidden');
            
            // è§£æè¨Šæ¯
            const msg = decodeURIComponent(urlParams.get('t') || "");
            // å°‡è¨Šæ¯æš«å­˜åœ¨ dataset ä¸­
            document.getElementById('typing-text').dataset.fullText = msg;

            // ç”Ÿæˆ QR Code ä¾›åˆ†äº«
            try { 
                new QRCode(document.getElementById('qrcode-container'), { 
                    text: window.location.href, 
                    width: 70, 
                    height: 70,
                    colorDark : "#2d3436",
                    colorLight : "#ffffff"
                }); 
            } catch(e){}
        }
    };

    // ç”¨æˆ¶é»æ“Šå¡ç‰‡æ™‚è§¸ç™¼
    function unlockAudioAndOpen() {
        const container = document.getElementById('card-container');
        const flap = document.getElementById('card-flap');
        const textEl = document.getElementById('typing-text');
        
        if (!container.classList.contains('is-open')) {
            // 1. æ’­æ”¾éŸ³æ¨‚ (å¿…é ˆåœ¨ click äº‹ä»¶ä¸­è§¸ç™¼ä»¥ç¹éç€è¦½å™¨é™åˆ¶)
            if (isPlayerReady) {
                player.playVideo();
                // ç¢ºä¿å–æ¶ˆéœéŸ³
                player.unMute(); 
                player.setVolume(70); 
            }

            // 2. å‹•ç•«è™•ç†
            flap.classList.remove('hint-animation');
            setTimeout(() => { container.classList.add('is-open'); }, 50);
            
            // 3. æ‰“å­—æ©Ÿæ•ˆæœ
            const msg = textEl.dataset.fullText || document.getElementById('userMsg').value;
            textEl.innerText = "";
            let i = 0;
            // å»¶é²ä¸€é»å†é–‹å§‹æ‰“å­—ï¼Œé…åˆå¡ç‰‡æ‰“é–‹çš„æ™‚é–“
            setTimeout(() => {
                if (typingInterval) clearInterval(typingInterval);
                typingInterval = setInterval(() => { 
                    if (i < msg.length) { 
                        textEl.innerText += msg[i]; 
                        i++; 
                    } else { 
                        clearInterval(typingInterval); 
                    } 
                }, 150);
            }, 1000);

            isCardOpened = true;
        } else {
            // å¦‚æœå†æ¬¡é»æ“Šï¼Œå¯ä»¥é¸æ“‡é—œé–‰å¡ç‰‡ä¸¦åœæ­¢éŸ³æ¨‚ (å¯é¸)
            // ç›®å‰é‚è¼¯ä¿æŒé–‹å•Ÿï¼Œè‹¥è¦é—œé–‰å¯ç§»é™¤è¨»è§£:
            /*
            container.classList.remove('is-open');
            if(isPlayerReady) player.pauseVideo();
            isCardOpened = false;
            */
        }
    }

    // ç·¨è¼¯å™¨åŠŸèƒ½ï¼šé è¦½
    function previewCard() {
        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('card-container').classList.remove('hidden');
        // è¨­å®šè‡¨æ™‚æ–‡å­—
        document.getElementById('typing-text').dataset.fullText = document.getElementById('userMsg').value;
    }

    // ç·¨è¼¯å™¨åŠŸèƒ½ï¼šç”Ÿæˆé€£çµ
    function generatePureUrl() {
        const msg = document.getElementById('userMsg').value;
        const params = new URLSearchParams();
        params.set('t', encodeURIComponent(msg));
        params.set('v', '3'); // ç‰ˆæœ¬è™Ÿ
        
        // ç§»é™¤åŸæœ‰çš„ abc åƒæ•¸ï¼Œå› ç‚ºä¸å†éœ€è¦æ¨‚è­œ
        const url = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
        
        navigator.clipboard.writeText(url).then(() => {
            alert("âœ… é€£çµå·²è¤‡è£½ï¼\n\nç™¼é€çµ¦æœ‹å‹ï¼Œä»–å€‘é»é–‹å¡ç‰‡æ™‚å°±æœƒè½åˆ° YouTube æ’­æ”¾æ¸…å–®çš„éŸ³æ¨‚å›‰ï¼");
        });
    }
</script>
</body>
</html>
