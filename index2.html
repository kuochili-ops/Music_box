<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¦¬å¹´æ©«å¼ App è³€å¡ ğŸ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { 
            --primary: #6c5ce7; 
            --bg: #f1f2f6; 
            --flip-duration: 1.6s; 
            --card-width: 500px; 
            --card-height: 350px;
            --neon-green: #39FF14;
        }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; perspective: 2000px; overflow: hidden; }
        
        #card-container { 
            width: var(--card-width); 
            height: var(--card-height); 
            position: relative; 
            transform-style: preserve-3d; 
            margin-top: 150px; 
        }

        /* ç¿»è“‹å€åŸŸ */
        #card-flap { 
            position: absolute; 
            width: 100%; height: 100%; 
            top: 0; left: 0; 
            transform-style: preserve-3d; 
            transform-origin: top; 
            transition: transform 0.3s ease-out; 
            z-index: 200; /* æé«˜å±¤ç´šç¢ºä¿é»æ“Š */
            cursor: pointer;
            transform: rotateX(0deg);
        }

        /* å‘¼å¸å‹•ç•« */
        .hint-animation { 
            animation: flap-hint 3s ease-in-out infinite; 
        }
        @keyframes flap-hint { 
            0%, 100% { transform: rotateX(0deg); } 
            50% { transform: rotateX(12deg); } 
        }

        /* å®Œæ•´ç¿»é–‹ç‹€æ…‹ */
        #card-container.is-open #card-flap { 
            transform: rotateX(180deg); 
            transition: transform var(--flip-duration) cubic-bezier(0.19, 1, 0.22, 1);
        }
        
        /* å°é¢å±¤ */
        #card-cover { 
            position: absolute; width: 100%; height: 100%; 
            background: url('cover_top.png') center/cover no-repeat; 
            border-radius: 12px 12px 0 0; 
            backface-visibility: hidden; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 2;
        }

        /* è£¡å´é¢å±¤ (ç¿»é–‹å¾Œçœ‹åˆ°çš„é¢) */
        #card-top-inner { 
            position: absolute; width: 100%; height: 100%; 
            background: #fff url('IMG_6830.PNG') center/cover no-repeat; 
            border-radius: 12px 12px 0 0; 
            transform: rotateX(180deg); 
            backface-visibility: hidden; 
            z-index: 1;
        }

        /* ä¸‹é åº•åº§å´é¢ */
        #card-bottom-inner { 
            position: absolute; width: 100%; height: 100%; 
            top: 0; left: 0; 
            background: #fff url('IMG_6829.png') center/cover no-repeat; 
            border-radius: 0 0 12px 12px; 
            display: flex; flex-direction: column; align-items: center; 
            padding: 20px; box-sizing: border-box; 
            z-index: 50;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        
        #music-visualizer { 
            display: flex; justify-content: center; align-items: flex-end; 
            width: 80%; height: 65px; background: rgba(0,0,0,0.7);
            border-radius: 10px; margin-top: 30px; padding: 12px; box-sizing: border-box; gap: 4px;
        }
        .bar { flex: 1; background: var(--neon-green); border-radius: 2px 2px 0 0; height: 5%; box-shadow: 0 0 8px var(--neon-green); }
        
        #typing-text { font-size: 1.3rem; font-weight: 800; color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.5); text-align: center; min-height: 2.5em; margin: 20px 0; width: 100%; }
        
        #qrcode-container { position: absolute; left: 15px; bottom: 15px; background: white; padding: 5px; border-radius: 5px; z-index: 60; }

        #mute-btn {
            position: fixed;
            right: 20px; bottom: 20px;
            width: 50px; height: 50px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .editor-box { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 420px; margin: 20px; z-index: 500; text-align: center; }
        .hidden { display: none !important; }

        @media (max-width: 600px) {
            :root { --card-width: 90vw; --card-height: 60vw; }
            #card-container { margin-top: 45vw; }
        }
    </style>
</head>
<body>

<div id="editor-ui" class="editor-box">
    <h3>ğŸ ğ“ƒ¥ ç™½å…­éŸ³æ¨‚è³€å¡è£½ä½œ</h3>
    <input type="text" id="userMsg" value="è¬é¦¬å¥”é¨°ï¼Œæ–°æ˜¥å¤§å‰ï¼" style="width:100%; padding:10px; margin-bottom:10px;">
    <button onclick="generatePureUrl()" style="width:100%; padding:10px; background:var(--primary); color:white; border:none; border-radius:10px;">ğŸ”— è¤‡è£½åˆ†äº«é€£çµ</button>
    <button onclick="previewCard()" style="width:100%; padding:10px; background:#b2bec3; color:white; border:none; border-radius:10px; margin-top:10px;">ğŸ‘€ é è¦½å¡ç‰‡</button>
</div>

<div id="card-container" class="hidden">
    <div id="card-flap" class="hint-animation" onclick="toggleCard()">
        <div id="card-cover"></div> 
        <div id="card-top-inner"></div>
    </div>
    <div id="card-bottom-inner">
        <div id="music-visualizer">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
        <div id="typing-text"></div>
        <div id="qrcode-container"></div>
    </div>
</div>

<div id="mute-btn" class="hidden" onclick="toggleMute()">ğŸ”Š</div>
<div id="yt-player-container" style="position:absolute; width:1px; height:1px; opacity:0;"><div id="yt-player"></div></div>

<script>
    let player, isPlayerReady = false, musicStarted = false, isMuted = false;
    const PLAYLIST_ID = 'PL1U2BLQmiBscIDy9QQvCmAF-rKjhafMuM'; 

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            height: '100', width: '100',
            playerVars: { 'listType': 'playlist', 'list': PLAYLIST_ID, 'autoplay': 0, 'controls': 0, 'loop': 1, 'playsinline': 1 },
            events: { 
                'onReady': (e) => { isPlayerReady = true; player.setShuffle(true); },
                'onStateChange': (e) => { if (e.data === YT.PlayerState.ENDED) player.playVideo(); }
            }
        });
    }

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);

    let visualizerInterval = null;
    function startPhysicsVisualizer() {
        if(visualizerInterval) return;
        const bars = document.querySelectorAll('.bar');
        let currentHeights = new Array(bars.length).fill(5);
        visualizerInterval = setInterval(() => {
            bars.forEach((bar, i) => {
                if (Math.random() < 0.22) currentHeights[i] = Math.random() * 85 + 10;
                currentHeights[i] -= 6;
                if (currentHeights[i] < 5) currentHeights[i] = 5;
                bar.style.height = `${currentHeights[i]}%`;
            });
        }, 50);
    }

    // æ ¸å¿ƒåˆ‡æ›é‚è¼¯
    function toggleCard() {
        const container = document.getElementById('card-container');
        const flap = document.getElementById('card-flap');
        const muteBtn = document.getElementById('mute-btn');
        
        // éŸ³æ¨‚å•Ÿå‹•
        if (!musicStarted && isPlayerReady) {
            player.playVideo();
            player.unMute();
            startPhysicsVisualizer();
            musicStarted = true;
            muteBtn.classList.remove('hidden');
        }

        if (container.classList.contains('is-open')) {
            // é–‰åˆ
            container.classList.remove('is-open');
            // å‹•ç•«çµæŸå¾Œæ¢å¾©å‘¼å¸
            setTimeout(() => {
                if(!container.classList.contains('is-open')) flap.classList.add('hint-animation');
            }, 1600); 
        } else {
            // é–‹å•Ÿ
            flap.classList.remove('hint-animation');
            // çµ¦äºˆä¸€å€‹æ¥µçŸ­å»¶é²ç¢ºä¿å‘¼å¸å‹•ç•«é¡åå·²è¢«ç§»é™¤ï¼Œé¿å… transition è¡çª
            setTimeout(() => {
                container.classList.add('is-open');
                startTyping();
            }, 50);
        }
    }

    function toggleMute() {
        if (!isPlayerReady) return;
        const btn = document.getElementById('mute-btn');
        if (isMuted) { player.unMute(); btn.innerText = 'ğŸ”Š'; } 
        else { player.mute(); btn.innerText = 'ğŸ”‡'; }
        isMuted = !isMuted;
    }

    function startTyping() {
        const textEl = document.getElementById('typing-text');
        if (textEl.innerText !== "") return;
        const msg = textEl.dataset.fullText || document.getElementById('userMsg').value;
        let i = 0;
        setTimeout(() => {
            const timer = setInterval(() => {
                if (i < msg.length) { textEl.innerText += msg[i]; i++; } else clearInterval(timer);
            }, 150);
        }, 1200);
    }

    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('t')) {
            document.getElementById('editor-ui').classList.add('hidden');
            document.getElementById('card-container').classList.remove('hidden');
            document.getElementById('typing-text').dataset.fullText = decodeURIComponent(urlParams.get('t'));
            new QRCode(document.getElementById('qrcode-container'), { text: window.location.href, width: 50, height: 50 });
        }
    };

    function previewCard() {
        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('card-container').classList.remove('hidden');
    }

    function generatePureUrl() {
        const msg = document.getElementById('userMsg').value;
        const finalUrl = `${window.location.origin}${window.location.pathname}?t=${encodeURIComponent(msg)}`;
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(finalUrl).then(() => alert("âœ… é€£çµå·²è¤‡è£½ï¼"));
        } else {
            prompt("è«‹æ‰‹å‹•è¤‡è£½é€£çµï¼š", finalUrl);
        }
    }
</script>
</body>
</html>
